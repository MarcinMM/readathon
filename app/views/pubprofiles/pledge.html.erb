<%= render "share", student_id: @student.id %>

<div class="content">
  <div class="box-960">
    <div class="small-breadcrumb">
      <div class="left-breadcrumb">
        <%= link_to "#{@student.first}'s Profile", pub_profile_path(@student.id) %>
        <a href="#"><i class="fa fa-angle-right"></i>Make a Pledge</a>
      </div>
      <div class="right-breadcrumb">
      </div>
      <div class="clear"></div>
      <div style="margin-bottom:20px;" class="decoration"></div>
    </div>

    <div class="one-half-responsive no-bottom" style="margin-right:5%">
      <h1 style="margin-bottom:0;font-size:30px;"><%= @student.first %></h1>
      <em><%= @student.teacher.grade.ordinalize %> Grade - <%= @student.teacher.last %> sensei</em>

      <br/><br/>
      <p>You can donate in two ways. You can pledge Cain for every hour Cain reads during the read-a-thon. For example,
        if you pledge $5 and hour and Cain reads 10 hours then you will have helped us raise $50. We have added an
        ability
        for you to set a min and a max to your bid. If you know you would like to at least help Cain by giving $20,
        then set that has your min. If you are worried about Cain reading the whole Harry Potter series durring the
        read-a-thon,
        then you can set your max to $100. A second way to donate is to just pledge a flat amount. If you know you want
        to
        give $50, nothing more nothing less, then feel free to donate that way.

        Thank you for your support!</p>

      <a href="#more_info">Find out more about how our money is raised and spent.</a>
    </div>

    <div style="margin-top:20px;" class="one-half-responsive last no-bottom">
      <div class="horizontalTab">
        <ul>
          <li><a href="#tab-3">Pledge Per Hour</a></li>
          <li><a href="#tab-4">Pledge Fixed $ Amount</a></li>
        </ul>

        <div id="tab-3">
          <h6 style="margin-bottom:0">Hourly Pledge</h6>
          <%= form_tag(pub_make_pledge_path(@student.id), id: 'hpledge', method: 'post') do %>
              <input type="hidden" name="pledge[ptype]" value="hourly"/>
              <input onfocus="if (this.value=='Name or Nickname (optional)') this.value = ''"
                     onblur="if (this.value=='') this.value = 'Name or Nickname (optional)'"
                     type="text" class="text-input-one good-value" name="pledge[name]"
                     value="Name or Nickname (optional)">
              <input onfocus="if (this.value=='Email Address (required)') this.value = ''"
                     onblur="if (this.value=='') this.value = 'Email Address (required)'"
                     type="email" class="text-input-one good-value" name="pledge[email]"
                     value="Email Address (required)" required>
              <textarea class="textarea-input contactTextarea field-deco requiredField" name="pledge[message]"
                        onfocus="if (this.value=='Message (optional)') this.value = ''"
                        onblur="if (this.value=='') this.value = 'Message (optional)'">Message (optional)</textarea>
              <input onfocus="if (this.value=='Pledge Per Hour (required)') this.value = ''"
                     onblur="if (this.value=='') this.value = 'Pledge Per Hour (required)'"
                     type="text" class="text-input-one good-value" name="pledge[amount]"
                     value="Pledge Per Hour (required)">
              <input onfocus="if (this.value=='Min Amount (optional)') this.value = ''"
                     onblur="if (this.value=='') this.value = 'Min Amount (optional)'"
                     type="text" class="text-input-one good-value" name="pledge[min_amt]"
                     value="Min Amount (optional)">
              <input onfocus="if (this.value=='Max Amount (optional)') this.value = ''"
                     onblur="if (this.value=='') this.value = 'Max Amount (optional)'"
                     type="text" class="text-input-one good-value" name="pledge[max_amt]"
                     value="Max Amount (optional)">
              <input type="submit" class="button button-green center-button" value="Make Pledge"/>
          <% end %>
          <p class="half-bottom"></p>
        </div>
        <div id="tab-4">
          <h6 style="margin-bottom:0">Fixed Pledge</h6>
          <%= form_tag(pub_make_pledge_path(@student.id), id: 'fpledge', method: "post") do %>
              <input type="hidden" name="pledge[ptype]" value="flat"/>
              <input onfocus="if (this.value=='Name or Nickname (optional)') this.value = ''"
                     onblur="if (this.value=='') this.value = 'Name or Nickname (optional)'"
                     type="text" class="text-input-one good-value" name="pledge[name]"
                     value="Name or Nickname (optional)">
              <input onfocus="if (this.value=='Email Address (required)') this.value = ''"
                     onblur="if (this.value=='') this.value = 'Email Address (required)'"
                     type="email" class="text-input-one good-value" name="pledge[email]"
                     value="Email Address (required)" required>
              <textarea class="textarea-input contactTextarea field-deco requiredField" name="pledge[message]"
                        onfocus="if (this.value=='Message (optional)') this.value = ''"
                        onblur="if (this.value=='') this.value = 'Message (optional)'">Message (optional)</textarea>
              <input onfocus="if (this.value=='Pledage Amount') this.value = ''"
                     onblur="if (this.value=='') this.value = 'Pledage Amount'"
                     type="text" class="text-input-one good-value" name="pledge[amount]"
                     value="Pledage Amount">
              <input type="submit" class="button button-green center-button" value="Make Pledge"/>
          <% end %>
          <p class="half-bottom"></p>
        </div>
      </div>
    </div>

    <script>
      $.validator.addMethod("currencyIfNotEq", function (value, element, param) {
        if (param == value) {
          return true;
        }

        var symbol = '$',
            soft = false,
            regex;

        symbol = symbol.replace(/,/g, "");
        symbol = soft ? symbol + "]" : symbol + "]?";
        regex = "^[" + symbol + "([1-9]{1}[0-9]{0,2}(\\,[0-9]{3})*(\\.[0-9]{0,2})?|[1-9]{1}[0-9]{0,}(\\.[0-9]{0,2})?|0(\\.[0-9]{0,2})?|(\\.[0-9]{1,2})?)$";
        regex = new RegExp(regex);
        return this.optional(element) || regex.test(value);

      }, "Please specify a valid currency");

      $.validator.addMethod('between0N9999', function (value, element, param) {
        if (value == param) {
          return true;
        }

        try {
          value = value.replace(/[^0-9|.|-]/g, '');
          return this.optional(element) || (parseInt(value) <= 9999 && parseInt(value) > 0);
        }
        catch (err) {
          return false;
        }
      }, "Must be an amount between 1 and 9999");

      jQuery.validator.addMethod("requiredNotEqual", function (value, element, param) {
        return this.optional(element) || value != param;
      }, "Required Field");

      jQuery.validator.addMethod("lengthBetween", function (value, element, param) {
        if (param[0] == value) {
          return true;
        }

        return this.optional(element) || (value.length >= param[1] && value.length <= param[2]);
      }, "Length between {1} and {2}.");

      $("#hpledge").validate({
        rules: {
          "pledge[name]": {lengthBetween: ["Name or Nickname (optional)", 3, 24]},
          "pledge[amount]": {requiredNotEqual: "Pledge Per Hour (required)"},
          "pledge[amount]": {currency: ['$', false]},
          "pledge[min_amt]": {currencyIfNotEq: "Min Amount (optional)"},
          "pledge[min_amt]": {between0N9999: "Min Amount (optional)"},
          "pledge[max_amt]": {currencyIfNotEq: "Max Amount (optional)"},
          "pledge[max_amt]": {between0N9999: "Max Amount (optional)"},
        }
      });

      $("#fpledge").validate({
        rules: {
          "pledge[name]": {lengthBetween: ["Name or Nickname (optional)", 3, 24]},
          "pledge[amount]": {requiredNotEqual: "Pledage Amount"},
          "pledge[amount]": {currency: ['$', false]},
        }
      });
    </script>

    <div class="decoration hide-if-responsive"></div>
    <div class="clear"></div>
    <br/><br/>
  </div>
</div>

<div id="more_info" class="parallax-strip bg5 full-bottom item" data-0="background-position:0px 0px;" data-150000="background-position:0px -50000px;">
  <div class="overlay"></div>
  <div class="box-960">
    <h1 class="center-text">Your Privacy is important to us</h1>
    <p class="center-text larger transparent">What are we going to do with your pledge data.</p>
  </div>
</div>

<div class="content">
  <div class="box-960">
    <div class="container center-heading">
      <p class="center-text larger full-bottom">
        The information you provide us is only used to this read-a-thon. It will not be shared with any 3rd party
        organizations. Or used in any way by our organization other than to help power this read-a-thon.
        We ask for your name or nickname, so that your sponsor can see who sponsdered them. Your email address will be
        used to contact you at the end of the read-a-thon for payment. We will not use thia address
        to contact you for any other purposes.
      </p>
    </div>
  </div>
</div>
